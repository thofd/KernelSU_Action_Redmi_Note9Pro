From 0123456789abcdef0123456789abcdef01234567 Mon Sep 17 00:00:00 2001
From: YourName <you@example.com>
Date: Thu, 15 May 2025 08:00:00 +0000
Subject: [PATCH] Fix KernelSU build errors: MODULE_IMPORT_NS and current_sid
 conflicts

---
 drivers/kernelsu/ksu.c                | 2 ++
 drivers/kernelsu/selinux/selinux.c    | 9 +++++++--
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/drivers/kernelsu/ksu.c b/drivers/kernelsu/ksu.c
index 0123456..89abcde 100644
--- a/drivers/kernelsu/ksu.c
+++ b/drivers/kernelsu/ksu.c
@@ -94,7 +94,9 @@ static struct task_struct *ksu_get_task_by_vpid(pid_t vpid)
     return NULL;
 }

+#ifdef CONFIG_MODULES
 MODULE_IMPORT_NS(VFS_internal_I_am_really_a_filesystem_and_am_NOT_a_driver);
+#endif

 static struct ksu_user *ksu_get_user(kuid_t uid)
 {
diff --git a/drivers/kernelsu/selinux/selinux.c b/drivers/kernelsu/selinux/selinux.c
index abcdef0..1234567 100644
--- a/drivers/kernelsu/selinux/selinux.c
+++ b/drivers/kernelsu/selinux/selinux.c
@@ -74,7 +74,12 @@
 #if (LINUX_VERSION_CODE < KERNEL_VERSION(5, 10, 0)) &&                         \
     defined(CONFIG_SECURITY_SELINUX) && defined(CONFIG_SECURITY)

-static inline u32 current_sid(void)
+/* Avoid redefinition if already defined in include/objsec.h */
+#ifndef current_sid
+static inline u32 current_sid(void)
 {
     return current->security->sid;
 }
+#endif
+
 #endif
